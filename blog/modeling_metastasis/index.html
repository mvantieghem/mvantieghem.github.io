<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Hugo 0.77.0" />
	
	<link rel="icon" href="/images/logo_name.png">
	
	<title>Modeling Metastasis | Blog</title>
	
	

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Modeling Metastasis"/>
<meta name="twitter:description" content="Predicting cancer outcomes in Merkel Cell Carcinoma Consulting project for Insight&rsquo;s Health Data Science program
Github | Web app | Demo
Merkel cell carcinoma is a rare but aggressive form of skin cancer - it’s five times more deadly than more common skin cancers, like melanoma."/>

	<meta property="og:title" content="Modeling Metastasis" />
<meta property="og:description" content="Predicting cancer outcomes in Merkel Cell Carcinoma Consulting project for Insight&rsquo;s Health Data Science program
Github | Web app | Demo
Merkel cell carcinoma is a rare but aggressive form of skin cancer - it’s five times more deadly than more common skin cancers, like melanoma." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/modeling_metastasis/" />
<meta property="article:published_time" content="2020-11-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-11-03T00:00:00+00:00" />


	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
	 crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	<link href="/css/medium.css" rel="stylesheet">
	<link href="/css/additional.css" rel="stylesheet">

	
	
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container pr-0">
        
        <a class="navbar-brand" href="//">

            
            <img src="/images/logo_name.png" alt="logo">
            
        </a>
        

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/blog">Blog</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/">About Me</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/static/experience">Experience</a>
                </li>
                
            </ul>
        </div>
        
    </div>
</nav>


        <div class="site-content">   
            <div class="container">
<div class="mainheading">
    <h1 class="sitetitle">Blog</h1>
    <p class="lead">
         
    </p>
</div><div class="main-content">
        
        <div class="container">
            <div class="row">
                
                <div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset">
    <p>Share</p>
    <ul>
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://twitter.com/intent/tweet?text=Modeling%20Metastasis&url=%2fblog%2fmodeling_metastasis%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;">
        <i class="fab fa-twitter"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://facebook.com/sharer.php?u=%2fblog%2fmodeling_metastasis%2f" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
        <i class="fab fa-facebook-f"></i>
        </a>
        </li>

        <li class="ml-1 mr-1">
        <a target="_blank" href="https://www.xing.com/spi/shares/new?url=%2fblog%2fmodeling_metastasis%2f" onclick="window.open(this.href, 'xing-share', 'width=550,height=435');return false;">
        <i class="fab fa-xing"></i>
        </a>
        </li>        
    </ul>

    
</div>
</div>
                                
                <div class="col-md-9 flex-first flex-md-unordered">
                    <div class="mainheading">
                        	
                        
                        
                        
                        <div class="row post-top-meta">
                            <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right">
                                <img class="author-thumb" src="/images/thumbnail.png" alt="Michelle VanTieghem">
                            </div>
                            <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left">
                                <a target="_blank" class="link-dark">Michelle VanTieghem</a><br>
                                <span class="author-description">
                                    <br>
                                    <i class="far fa-star"></i>
                                    Nov 3, 2020
                                    <i class="far fa-clock clock"></i>
                                    6 min read
                                </span>					
                            </div>
                        </div>			
                        	
                        
                                                
                        
                        <h1 class="posttitle">Modeling Metastasis</h1> 
                    </div>

                    
                    
                    
                    

                    
                    <div class="article-post">
                        <h2 id="predicting-cancer-outcomes-in-merkel-cell-carcinoma">Predicting cancer outcomes in Merkel Cell Carcinoma</h2>
<p><strong>Consulting project for Insight&rsquo;s Health Data Science program</strong></p>
<p><a href="github.com/mvantieghem/mcc_metastasis">Github</a> | <a href="https://share.streamlit.io/mvantieghem/mcc_metastasis/master/live_app.py">Web app</a> | <a href="https://www.youtube.com/watch?v=o4iRkPfRkaA&amp;feature=youtu.be">Demo</a></p>
<p>Merkel cell carcinoma is a rare but aggressive form of skin cancer - it’s five times more deadly than more common skin cancers, like melanoma. Because the cancer is so aggressive, after initial diagnosis, all patients are recommended to undergo a biopsy procedure to determine whether the cancer has metastasized to the lymph nodes.</p>
<p>However, the biopsy procedure has a high complication rate, with about 10% of patients experiencing surgical complications like infection. Only about 30% of patients who receive the lymph node biopsy actually have a positive result of metastasis &ndash; which means that the other 70% of patients undergo an unnecessary surgery. Because of this high burden to the patient, physicians want to be able to identify which patients have low risk for metastasis and can avoid the lymph node biopsy procedure.</p>
<p>For my insight project, I consulted with physicians at OHSU who specialize in skin cancer research to tackle this problem. My goal was to develop a machine learning model that can predict probability of metastasis from new patient data, which could then be used to guide clinical decision-making about the biopsy procedure.</p>
<h2 id="data-challenges">Data challenges</h2>
<p>I used publicly available data on Merkel Cell Carcinoma from the National Cancer Database. Although this database, which began in 2002, has records for almost 15,000 patients, the recording of sentinel lymph node (SLN) biopsies did not start until 2012 - which meant about two-thirds of the data was not usable for this analysis. There was also a lot of missing data in several important variables to include in the model. For example, several histologic features about the merkel cell tumor (e.g. size, growth pattern) were not available for all patients.</p>
<p>After cleaning the data, I decided to use imputation methods to recover more patient cases and maximize the sample size. I used IterativeImputation in Sklearn, which is a regression-based imputation technique that predicts the missing values based on the other available features in the data. It does this in a round-robin fashion, until all missing variables are filled in.</p>
<p>After processing the data, I had ~2500 patient records with 7 features. The features included basic demographic information, like age and sex, as well as variables about the merkel cell tumor: size, location on the body, and histologic features about the tumor recorded from a dermopathologist.</p>
<h2 id="model-training">Model training</h2>
<p>First, I split the data into training (50%), validation (25%), and hold-out test sets (25%). Because there were 2x more cases with negative outcomes (i.e, no metastasis), I stratified the samples based on the outcome variable. This ensured that each set of the data had a similar proportion of positive and negative cases of metastasis.</p>
<p>Next, I set up the model training to predict positive vs. negative cases of metastasis. I focused on logistic regression as my primary classification algorithm because it was important for the physicians I consulted with to have a model that clinicians could easily interpret. Due to the imbalance in classes, I used balanced class weights in the logistic regression, which substantially improved the model performance.</p>
<h4 id="probability-calibration">Probability calibration</h4>
<p>I also applied probability calibration so that the predicted probabilities better reflected the relative risk observed in the sample. Many classification algorithms don’t have well-calibrated probabilities, because the models are optimizing the ranking of predictions for classification, which was the case for my simple logistic regression. Given that we planned to use the model to generate predicted probabilities of metastasis for new patients, having a well-calibrated model was a priority for this project. In other words, cases with predicted probability of 0.1 should only have true positive metastasis outcomes 10% of the time. I used CalibrationClassifierCV in Sklearn, which allowed me to compare both parametric and non-parametric calibration methods during model training.</p>
<p>Because I had a relatively modest sample size (only 1K cases for training), I used 5 resampled iterations of the data with 3-fold cross-fold validation.  This method applies random resampling to the data 5x (like bootstrapping), and then generates 3 cross-validation folds for each resample. By comparing the model training results across a total of 15 iterations, I had more confidence that the training results would generalize to new data.</p>
<h4 id="decision-thresholds">Decision thresholds</h4>
<p>After training the model, I performed a separate validation step to tune the decision threshold for the model. By default, classification algorithms assume a decision threshold of 0.5, where predicted probabilities &gt; 0.5 are labeled as ‘positive’, and probabilities &lt; 0.5 are labeled as ‘negative’. However, labeling a patient with .45 predicted probability of metastasis as “negative” isn’t ideal for this clinical application, because they actually have a relatively high chance of metastasis. Instead, we want to have greater confidence that cases labeled as ‘negative’ have a very low incidence of metastasis (e.g. &lt; 5% metastasis). This is reflected in the metric of precision for the negative class, or the number of true ‘negative’ cases out of all predicted ‘negative’ cases. In a separate validation set, I chose a decision threshold that maximized the precision for the negative class.</p>
<h3 id="model-evaluation">Model evaluation</h3>
<p>As the final step, I evaluated the model on the hold-out test set, which achieved a relatively high precision for the negative class. This means we identified a sub-group of patients we are most confident don’t have metastasis, and could potentially avoid the lymph node biopsy. However, optimizing for precision came at a cost to recall, because now many ‘negative’ cases were labelled as ‘positive’ for metastasis. This means that for new patient data, many patients who don’t have metastasis would still be recommended for biopsy. However, currently all patients with Merkel Cell Carcinoma are recommended for biopsy, so the model predictions still provide an improvement over the current clinical standard of care.</p>
<h2 id="deliverables">Deliverables</h2>
<h4 id="statistical-inference">Statistical inference</h4>
<p>The physicians I worked with didn’t just want black-box predictions; they also wanted to interpret the model coefficients to understand relative risk for each feature. After training the model, I used bootstrap resampling (1000 iterations) with the training set to generate confidence intervals for the model coefficients. These results provided valuable information about which features were most important for the model prediction. For example, the most important variable was a histologic feature about the merkel cell tumor, which was not recorded for the majority of patients in the NCDB.  Given that Merkel Cell Carcinoma is a relatively rare cancer, it’s also under-studied, and these results will provide valuable information for the field to improve data collection standards moving forward.</p>
<h4 id="clinical-prototype">Clinical prototype</h4>
<p>Ultimately, the physicians plan to use these model predictions to inform clinical decision-making about whether new Merkel Cell patients should undergo the lymph node biopsy. As a clinical prototype, I created a web application in streamlit that deploys the final model and generates a predicted probability from new patient data. The physicians enter new data about the patient (e.g. characteristics about their merkel cell tumor), and obtain the predicted risk of metastasis. This will allow patients to better understand their relative risk level when discussing their care plan with their physician.</p>

                    </div>
                    
                    
                    <div class="after-post-tags">
                        <ul class="tags">
                        
                        <li>
                        <a href="/tags/data-science">Data Science</a>
                        </li>
                        
                        <li>
                        <a href="/tags/classification">Classification</a>
                        </li>
                        
                        <li>
                        <a href="/tags/sklearn">Sklearn</a>
                        </li>
                        
                        </ul>
                    </div>
                    
                    
                    
                    <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
                    
                    
                        <a class="d-block col-md-6 text-lg-right" href="/blog/hugo_website_tutorial/">Building a Website with Blogdown, Hugo and Github Pages &raquo;</a>
                    
                    <div class="clearfix"></div>
                    </div>
                    
                </div>
                
            </div>
        </div>
        
        
    </div>


            </div>
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
			<div class="d-md-flex align-items-center justify-content-center h-100">
				<h2 class="d-md-block d-none align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
			</div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
			
			<a class="mt-1 mb-1" href="/tags/blogdown">blogdown</a>
			
			<a class="mt-1 mb-1" href="/tags/classification">classification</a>
			
			<a class="mt-1 mb-1" href="/tags/data-science">data-science</a>
			
			<a class="mt-1 mb-1" href="/tags/hugo">hugo</a>
			
			<a class="mt-1 mb-1" href="/tags/r">r</a>
			
			<a class="mt-1 mb-1" href="/tags/research">research</a>
			
			<a class="mt-1 mb-1" href="/tags/shiny">shiny</a>
			
			<a class="mt-1 mb-1" href="/tags/sklearn">sklearn</a>
			
		</div>
	</div>
</div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Michelle VanTieghem - All rights reserved
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" rel="noopener" href="https://www.wowthemes.net">Mediumish Theme</a> by WowThemes.net
            </div>
        </div>
    </div>
</footer>


        </div>


<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script src="/js/mediumish.js"></script>

    </body>
</html>
